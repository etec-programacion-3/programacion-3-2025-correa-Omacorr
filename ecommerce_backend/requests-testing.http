### ===========================================
### ECOMMERCE BACKEND - API TESTING
### ===========================================

### Variables
@baseUrl = http://127.0.0.1:8000/api/v1
@token = Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJvbWFyX3Rlc3QiLCJleHAiOjE3NjMxMjk3OTh9.7dTJ0qR4wpJSyN4QsLrvNQbKES-MdUnXVFCGthnJvaY

### 丘멆잺 GU칈A R츼PIDA DE USO:
###
### PASO 1: Aseg칰rate de que el backend est칠 corriendo
###   cd ecommerce_backend
###   source venv/bin/activate  (o venv\Scripts\activate en Windows)
###   uvicorn app.main:app --reload --host 127.0.0.1 --port 8000
###
### PASO 2: Crea un usuario
###   - Ejecuta el REGISTRO (secci칩n 1.1 abajo)
###   - Deber칤as recibir un token en la respuesta
###
### PASO 3: Obt칠n tu token de acceso
###   - Ejecuta el LOGIN (secci칩n 1.2.1 es m치s simple que 1.2)
###   - Copia SOLO el valor de "access_token" de la respuesta
###   - Ejemplo: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOi...
###
### PASO 4: Configura el token en este archivo
###   - Ve a la l칤nea 7 arriba
###   - Reemplaza el token actual con tu nuevo token
###   - Debe quedar: @token = Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
###   - IMPORTANTE: Debe decir "Bearer" seguido de un ESPACIO y luego el token
###   - Guarda el archivo (Ctrl+S)
###
### PASO 5: Usa los endpoints protegidos
###   - Ahora puedes ejecutar cualquier endpoint que tenga "Authorization: {{token}}"
###   - Los tokens expiran en 30 minutos, si ves error 401, repite desde PASO 3
###
### 游눠 TIPS:
###   - Usa /auth/login-simple (1.2.1) en lugar de /auth/login (es m치s simple)
###   - El login requiere tu EMAIL (no el username) en el campo "username"
###   - Si ves error 404 "Usuario no encontrado", ejecuta primero el REGISTRO (1.1)

### ===========================================
### 1. AUTENTICACI칍N
### ===========================================

### 1.1 Registro de nuevo usuario
POST {{baseUrl}}/auth/register
Content-Type: application/json

{
  "username": "omar_test",
  "email": "omar@test.com",
  "password": "test123456",
  "nombre": "Omar",
  "apellido": "Rodriguez",
  "direccion": "Av. Las Heras 123",
  "telefono": "+54 261 123-4567"
}

### 1.2 Login de usuario (OAuth2 - usar EMAIL en campo username)
POST {{baseUrl}}/auth/login
Content-Type: application/x-www-form-urlencoded

username=omar@test.com&password=test123456

### 1.2.1 Login alternativo (JSON - m치s simple)
POST {{baseUrl}}/auth/login-simple
Content-Type: application/json

{
  "email": "omar@test.com",
  "password": "test123456"
}

### 1.3 Obtener perfil actual (endpoint legacy)
GET {{baseUrl}}/usuarios/me/profile
Authorization: {{token}}

### ===========================================
### 2. GESTI칍N DE USUARIOS
### ===========================================

### 2.1 Obtener mi perfil completo (requiere token)
GET {{baseUrl}}/usuarios/me
Authorization: {{token}}

### 2.2 Actualizar mi perfil (requiere token)
PUT {{baseUrl}}/usuarios/me
Authorization: {{token}}
Content-Type: application/json

{
  "nombre": "Omar Actualizado",
  "apellido": "Rodriguez Correa",
  "telefono": "+54 261 987-6543",
  "direccion": "Nueva Direcci칩n 456",
  "ciudad": "Mendoza",
  "provincia": "Mendoza",
  "codigo_postal": "5500"
}

### 2.3 Obtener usuario p칰blico por username (no requiere token)
GET {{baseUrl}}/usuarios/omar_test

### ===========================================
### 3. PRODUCTOS
### ===========================================

### 3.1 Listar todos los productos
GET {{baseUrl}}/products/

### 3.2 Productos con paginaci칩n
GET {{baseUrl}}/products/?page=1&page_size=5

### 3.3 Filtrar por categor칤a
GET {{baseUrl}}/products/?categoria=Tecnolog칤a

### 3.4 Filtrar por vendedor
GET {{baseUrl}}/products/?vendedor_id=1

### 3.5 Buscar por texto
GET {{baseUrl}}/products/?search=smartphone

### 3.6 Filtros combinados
GET {{baseUrl}}/products/?categoria=Veh칤culos&search=auto&page=1&page_size=3

### 3.7 Crear nuevo producto
POST {{baseUrl}}/products/
Authorization: {{token}}
Content-Type: application/json

{
  "nombre": "MacBook Pro M3 14 pulgadas",
  "descripcion": "Laptop Apple MacBook Pro con chip M3, 16GB RAM, 512GB SSD. Estado impecable, poco uso, incluye cargador original.",
  "precio": 450000.00,
  "stock": 1,
  "categoria": "Tecnolog칤a",
  "imagen_url": "https://example.com/macbook-m3.jpg"
}

### 3.8 Obtener producto espec칤fico
GET {{baseUrl}}/products/1

### 3.9 Actualizar mi producto
PUT {{baseUrl}}/products/1
Authorization: {{token}}
Content-Type: application/json

{
  "nombre": "MacBook Pro M3 - PRECIO REBAJADO",
  "precio": 420000.00,
  "stock": 1,
  "descripcion": "OFERTA! Laptop Apple MacBook Pro con chip M3, precio rebajado por venta r치pida."
}

### 3.10 Obtener mis productos
GET {{baseUrl}}/products/mis-productos
Authorization: {{token}}

### 3.11 Eliminar mi producto
DELETE {{baseUrl}}/products/1
Authorization: {{token}}

### ===========================================
### 4. CALIFICACIONES DE PRODUCTOS
### ===========================================

### 4.1 Agregar calificaci칩n
POST {{baseUrl}}/products/2/reviews
Authorization: {{token}}
Content-Type: application/json

{
  "puntuacion": 5,
  "comentario": "Excelente producto! Tal como se describ칤a, vendedor muy confiable. Recomendado 100%."
}

### 4.2 Ver calificaciones de producto
GET {{baseUrl}}/products/2/reviews

### 4.3 Ver mi calificaci칩n de un producto
GET {{baseUrl}}/products/2/reviews/my-review
Authorization: {{token}}

### ===========================================
### 5. SISTEMA DE PEDIDOS
### ===========================================

### 5.1 Crear pedido
POST {{baseUrl}}/orders/
Authorization: {{token}}
Content-Type: application/json

{
  "items": [
    {
      "producto_id": 2,
      "cantidad": 1,
      "precio_unitario": 75000.00
    },
    {
      "producto_id": 3,
      "cantidad": 2,
      "precio_unitario": 25000.00
    }
  ]
}

### 5.2 Ver mis pedidos
GET {{baseUrl}}/orders/
Authorization: {{token}}

### ===========================================
### 6. SISTEMA DE MENSAJER칈A
### ===========================================

### 6.1 Crear conversaci칩n
POST {{baseUrl}}/conversations/
Authorization: {{token}}
Content-Type: application/json

{
  "usuario2_id": 2
}

### 6.2 Ver mis conversaciones
GET {{baseUrl}}/conversations/
Authorization: {{token}}

### 6.3 Ver mensajes de conversaci칩n
GET {{baseUrl}}/conversations/1/messages
Authorization: {{token}}

### 6.4 Enviar mensaje
POST {{baseUrl}}/conversations/1/messages
Authorization: {{token}}
Content-Type: application/json

{
  "contenido": "Hola! Me interesa tu producto. 쯇odr칤as darme m치s detalles sobre el estado?"
}

### 6.5 Enviar otro mensaje
POST {{baseUrl}}/conversations/1/messages
Authorization: {{token}}
Content-Type: application/json

{
  "contenido": "쮸ceptas efectivo? 쮻칩nde podr칤amos encontrarnos para ver el producto?"
}

### ===========================================
### 7. FLUJOS DE TESTING COMPLETOS
### ===========================================

### FLUJO 1: Usuario nuevo
# 1. POST /auth/register
# 2. POST /auth/login (copiar token)
# 3. GET /usuarios/me (verificar perfil)
# 4. PUT /usuarios/me (actualizar datos)

### FLUJO 2: CRUD Productos
# 1. POST /products/ (crear producto)
# 2. GET /products/ (listar todos)
# 3. GET /products/mis-productos (mis productos)
# 4. PUT /products/{id} (actualizar)
# 5. DELETE /products/{id} (eliminar)

### FLUJO 3: Proceso de compra
# 1. GET /products/ (explorar productos)
# 2. GET /products/?categoria=Tecnolog칤a (filtrar)
# 3. POST /orders/ (crear pedido)
# 4. GET /orders/ (verificar pedido)

### FLUJO 4: Interacci칩n vendedor-comprador
# 1. POST /conversations/ (iniciar conversaci칩n)
# 2. POST /conversations/1/messages (preguntar por producto)
# 3. GET /conversations/1/messages (leer respuestas)
# 4. POST /products/1/reviews (calificar producto)

### ===========================================
### 8. CASOS DE PRUEBA ESPEC칈FICOS
### ===========================================

### 8.1 Productos por categor칤as de tu constants.ts
GET {{baseUrl}}/products/?categoria=Tecnolog칤a
###
GET {{baseUrl}}/products/?categoria=Hogar
###
GET {{baseUrl}}/products/?categoria=Ropa
###
GET {{baseUrl}}/products/?categoria=Deportes
###
GET {{baseUrl}}/products/?categoria=Veh칤culos
###
GET {{baseUrl}}/products/?categoria=Libros
###
GET {{baseUrl}}/products/?categoria=Otros

### 8.2 B칰squedas t칤picas
GET {{baseUrl}}/products/?search=iphone
###
GET {{baseUrl}}/products/?search=auto
###
GET {{baseUrl}}/products/?search=casa
###
GET {{baseUrl}}/products/?search=libro

### 8.3 Paginaci칩n con diferentes tama침os
GET {{baseUrl}}/products/?page=1&page_size=2
###
GET {{baseUrl}}/products/?page=2&page_size=2
###
GET {{baseUrl}}/products/?page=1&page_size=10

### ===========================================
### 9. CASOS DE ERROR (para testing)
### ===========================================

### 9.1 Producto inexistente
GET {{baseUrl}}/products/999

### 9.2 Login con credenciales incorrectas
POST {{baseUrl}}/auth/login
Content-Type: application/x-www-form-urlencoded

username=noexiste&password=wrong

### 9.3 Acceso sin token
GET {{baseUrl}}/usuarios/me

### 9.4 Crear producto sin autenticaci칩n
POST {{baseUrl}}/products/
Content-Type: application/json

{
  "nombre": "Test Product",
  "precio": 1000
}

### ===========================================
### NOTAS IMPORTANTES
### ===========================================

# 1. ANTES DE EMPEZAR:
#    - Aseg칰rate que el backend est칠 corriendo en puerto 8000
#    - Verifica que la base de datos est칠 creada (python -c "from app.database import create_tables; create_tables()")

# 2. FLUJO RECOMENDADO:
#    a. Registrar usuario (1.1) - guarda el EMAIL que usaste
#    b. Hacer login (1.2 o 1.2.1) - IMPORTANTE: usar el EMAIL, no el username
#    c. COPIAR el access_token de la respuesta
#    d. Reemplazar YOUR_TOKEN_AQUI en l칤nea 7 con: Bearer tu_token_copiado
#    e. Ahora puedes usar todos los endpoints protegidos
#
# IMPORTANTE SOBRE LOGIN:
#    - El endpoint /auth/login (1.2) usa OAuth2 y requiere el EMAIL en el campo "username"
#    - El endpoint /auth/login-simple (1.2.1) es m치s intuitivo y usa JSON con el campo "email"
#    - Ambos funcionan igual, usa el que prefieras

# 3. TIPS:
#    - Ejecutar requests en orden para mejor testing
#    - Algunos endpoints requieren datos previos (ej: crear productos antes de hacer pedidos)
#    - Los IDs deben corresponder a registros existentes en tu BD
#    - Para testing completo, crear varios usuarios y productos

# 4. ENDPOINTS QUE NO REQUIEREN TOKEN:
#    - POST /auth/register
#    - POST /auth/login
#    - GET /products/
#    - GET /products/{id}
#    - GET /products/{id}/reviews
#    - GET /usuarios/{username}

# 5. ENDPOINTS QUE REQUIEREN TOKEN:
#    - Todos los endpoints bajo /usuarios/me
#    - POST/PUT/DELETE de /products/
#    - Todo el sistema de pedidos (/orders/)
#    - Todo el sistema de mensajer칤a (/conversations/)
#    - Crear calificaciones

### ===========================================
### COMANDOS DE BACKEND
### ===========================================

# Para iniciar el backend:
# cd ecommerce_backend
# source venv/bin/activate  (o venv\Scripts\activate en Windows)
# uvicorn app.main:app --reload --host 127.0.0.1 --port 8000

# Documentaci칩n autom치tica disponible en:
# http://127.0.0.1:8000/docs
